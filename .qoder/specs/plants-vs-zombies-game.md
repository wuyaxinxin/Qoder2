# 植物大战僵尸小游戏 - 实现计划

## 概述
基于 HTML5 Canvas + 原生 JavaScript 创建一个独立的植物大战僵尸小游戏，包含向日葵、豌豆射手、基础僵尸和阳光收集系统。

## 技术选型
- **渲染**: HTML5 Canvas
- **语言**: 原生 JavaScript (ES6+)
- **架构**: 面向对象 + 游戏循环模式
- **项目位置**: `/Users/admin/Documents/testQoder/Qoder2/pvz-game/` (独立目录)

## 文件结构

```
pvz-game/
├── index.html              # 游戏主页面
├── css/
│   └── game.css            # 游戏样式
└── js/
    ├── main.js             # 游戏入口
    ├── config.js           # 游戏配置常量
    ├── Game.js             # 游戏引擎核心类
    ├── entities/
    │   ├── Entity.js       # 实体基类
    │   ├── Plant.js        # 植物基类
    │   ├── Sunflower.js    # 向日葵
    │   ├── PeaShooter.js   # 豌豆射手
    │   ├── Zombie.js       # 僵尸类
    │   ├── Bullet.js       # 子弹类
    │   └── Sun.js          # 阳光类
    └── systems/
        ├── GridSystem.js   # 网格系统
        └── CollisionSystem.js # 碰撞检测
```

## 核心功能

### 1. 游戏引擎
- 基于 `requestAnimationFrame` 的游戏循环
- 固定时间步长 (60 FPS) 的逻辑更新
- Canvas 渲染管理

### 2. 网格系统
- 5行 x 9列 草坪网格
- 屏幕坐标 <-> 网格坐标转换
- 格子占用检测

### 3. 植物系统
| 植物 | 消耗阳光 | 功能 |
|------|---------|------|
| 向日葵 | 50 | 每24秒产生25阳光 |
| 豌豆射手 | 100 | 每1.4秒发射子弹 |

### 4. 僵尸系统
- 从右侧随机行生成
- 向左移动，遇到植物停止并攻击
- 到达左边界则游戏失败

### 5. 阳光系统
- 天空随机掉落阳光
- 向日葵产生阳光
- 点击收集阳光

### 6. 碰撞检测
- 基于行的空间分区优化
- AABB 矩形碰撞检测
- 子弹 vs 僵尸
- 僵尸 vs 植物

## 实现步骤

### 第1步：基础框架
- [ ] 创建 `index.html` 和 Canvas 元素 (800x600)
- [ ] 创建 `config.js` 定义游戏常量
- [ ] 实现 `Game.js` 游戏循环和渲染基础

### 第2步：网格和UI
- [ ] 实现 `GridSystem.js` 5x9网格管理
- [ ] 绘制草坪背景和网格
- [ ] 实现阳光计数器UI
- [ ] 实现植物卡片选择UI

### 第3步：植物实现
- [ ] 实现 `Entity.js` 基类
- [ ] 实现 `Plant.js` 植物基类
- [ ] 实现 `Sunflower.js` 向日葵
- [ ] 实现 `PeaShooter.js` 豌豆射手
- [ ] 实现植物放置逻辑（点击卡片 -> 放置到网格）

### 第4步：阳光系统
- [ ] 实现 `Sun.js` 阳光类
- [ ] 实现天空掉落阳光
- [ ] 实现向日葵产生阳光
- [ ] 实现点击收集阳光

### 第5步：战斗系统
- [ ] 实现 `Bullet.js` 子弹类
- [ ] 实现 `Zombie.js` 僵尸类
- [ ] 实现 `CollisionSystem.js` 碰撞检测
- [ ] 实现僵尸生成波次

### 第6步：游戏逻辑
- [ ] 实现游戏胜利条件（击杀20个僵尸）
- [ ] 实现游戏失败条件（僵尸到达左侧）
- [ ] 实现游戏结束界面和重新开始

## 关键配置参数

```javascript
// 网格配置
GRID_ROWS: 5
GRID_COLS: 9
CELL_WIDTH: 80
CELL_HEIGHT: 100

// 植物配置
SUNFLOWER_COST: 50
PEASHOOTER_COST: 100

// 僵尸配置
ZOMBIE_HP: 200
ZOMBIE_SPEED: 20  // 像素/秒

// 子弹配置
PEA_DAMAGE: 20
PEA_SPEED: 200

// 游戏规则
INITIAL_SUN: 100
WIN_KILLS: 20
```

## 验证方式

1. **功能验证**：在浏览器中打开 `index.html`
2. **测试流程**：
   - 收集阳光 -> 种植向日葵 -> 收集更多阳光
   - 种植豌豆射手 -> 等待僵尸出现 -> 观察子弹攻击
   - 验证游戏胜利/失败条件
3. **性能检查**：确保游戏运行流畅 (60 FPS)

## 预期成果

一个可在浏览器直接运行的植物大战僵尸小游戏，包含：
- 完整的游戏循环
- 两种植物（向日葵、豌豆射手）
- 基础僵尸
- 阳光收集机制
- 胜负判定
