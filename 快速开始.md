# 学生管理系统 - 快速开始指南

## 系统概述

这是一个完整的学生管理系统,基于FastAPI框架开发,实现了学生信息管理、成绩管理、统计分析等功能。

## 项目特点

✅ **完整的分层架构**: 表现层、业务逻辑层、数据访问层、数据存储层
✅ **RESTful API设计**: 遵循REST规范,统一的响应格式
✅ **JWT身份认证**: 基于令牌的安全认证机制
✅ **多角色权限控制**: 管理员、教师、学生三种角色
✅ **完善的数据验证**: Pydantic数据验证,确保数据质量
✅ **自动API文档**: Swagger/ReDoc自动生成的交互式文档
✅ **单元测试覆盖**: 包含单元测试和集成测试

## 技术栈

- **后端框架**: FastAPI 0.104
- **数据库**: SQLite (可切换PostgreSQL)
- **ORM**: SQLAlchemy 2.0
- **数据验证**: Pydantic 2.0
- **认证**: JWT (python-jose)
- **测试**: Pytest

## 目录结构

```
Qoder2/
├── app/                        # 应用主目录
│   ├── api/                    # API路由层
│   │   ├── v1/                 # API v1版本
│   │   │   ├── auth.py         # 认证接口
│   │   │   ├── students.py     # 学生管理接口
│   │   │   ├── grades.py       # 成绩管理接口
│   │   │   └── statistics.py   # 统计分析接口
│   │   └── deps.py             # 依赖注入
│   ├── core/                   # 核心模块
│   │   ├── config.py           # 配置文件
│   │   ├── security.py         # 安全模块(JWT、密码)
│   │   ├── database.py         # 数据库连接
│   │   └── middleware.py       # 中间件
│   ├── models/                 # 数据模型(SQLAlchemy)
│   │   ├── user.py             # 用户模型
│   │   ├── student.py          # 学生模型
│   │   ├── class_model.py      # 班级模型
│   │   ├── course.py           # 课程模型
│   │   ├── grade.py            # 成绩模型
│   │   └── teaching.py         # 授课模型
│   ├── schemas/                # 数据模式(Pydantic)
│   │   ├── user.py             # 用户schema
│   │   ├── student.py          # 学生schema
│   │   ├── class_schema.py     # 班级schema
│   │   ├── course.py           # 课程schema
│   │   ├── grade.py            # 成绩schema
│   │   └── statistics.py       # 统计schema
│   ├── services/               # 业务逻辑层
│   │   ├── auth_service.py     # 认证服务
│   │   ├── student_service.py  # 学生服务
│   │   ├── grade_service.py    # 成绩服务
│   │   └── statistics_service.py # 统计服务
│   ├── repositories/           # 数据访问层
│   │   ├── user_repo.py        # 用户仓储
│   │   ├── student_repo.py     # 学生仓储
│   │   ├── class_repo.py       # 班级仓储
│   │   ├── course_repo.py      # 课程仓储
│   │   └── grade_repo.py       # 成绩仓储
│   └── utils/                  # 工具函数
│       ├── validators.py       # 数据验证器
│       ├── helpers.py          # 辅助函数
│       └── exceptions.py       # 自定义异常
├── tests/                      # 测试目录
│   ├── unit/                   # 单元测试
│   ├── integration/            # 集成测试
│   └── conftest.py             # 测试配置
├── main.py                     # 应用入口
├── init_db.py                  # 数据库初始化脚本
├── requirements.txt            # 依赖包列表
└── start.sh                    # 快速启动脚本

```

## 快速开始

### 方法一: 使用启动脚本(推荐)

```bash
chmod +x start.sh
./start.sh
```

### 方法二: 手动启动

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 初始化数据库
python init_db.py

# 3. 启动应用
python main.py
```

### 访问系统

- **应用地址**: http://localhost:8000
- **API文档**: http://localhost:8000/docs (Swagger UI)
- **API文档**: http://localhost:8000/redoc (ReDoc)

### 初始账号

| 角色 | 用户名 | 密码 |
|-----|-------|------|
| 管理员 | admin | admin123 |
| 教师 | teacher001 | teacher123 |

## 核心功能

### 1. 用户认证

- ✅ JWT令牌登录
- ✅ 令牌刷新
- ✅ 密码修改
- ✅ 获取当前用户信息

### 2. 学生管理

- ✅ 创建学生(管理员)
- ✅ 查询学生列表(支持分页、筛选)
- ✅ 查询学生详情
- ✅ 更新学生信息
- ✅ 删除学生(逻辑删除)

### 3. 成绩管理

- ✅ 录入成绩
- ✅ 批量录入成绩
- ✅ 查询学生成绩
- ✅ 更新成绩
- ✅ 删除成绩

### 4. 统计分析

- ✅ 学生成绩统计(平均分、GPA、及格率等)
- ✅ 班级成绩统计(分数段分布)
- ✅ 课程成绩统计(优秀率、及格率)

## API使用示例

### 1. 登录获取Token

```bash
curl -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

响应:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800,
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### 2. 创建学生

```bash
curl -X POST "http://localhost:8000/api/v1/students" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "student_id": "2024006",
    "name": "新学生",
    "age": 20,
    "gender": "male",
    "major": "计算机科学与技术",
    "enrollment_date": "2024-09-01"
  }'
```

### 3. 查询学生列表

```bash
curl -X GET "http://localhost:8000/api/v1/students?page=1&size=20" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 4. 录入成绩

```bash
curl -X POST "http://localhost:8000/api/v1/grades" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "student_id": 1,
    "course_id": 1,
    "score": 85.5,
    "semester": "2024春",
    "academic_year": 2024,
    "grade_type": "期末"
  }'
```

## 权限说明

### 角色权限矩阵

| 功能 | 管理员 | 教师 | 学生 |
|-----|-------|------|------|
| 创建学生 | ✅ | ❌ | ❌ |
| 查看学生列表 | ✅ | ✅ | ❌ |
| 查看学生详情 | ✅ | ✅ | 仅本人 |
| 更新学生信息 | ✅ | ❌ | ❌ |
| 删除学生 | ✅ | ❌ | ❌ |
| 录入成绩 | ✅ | ✅ | ❌ |
| 查看成绩 | ✅ | ✅ | 仅本人 |
| 修改成绩 | ✅ | ✅ | ❌ |
| 统计报表 | ✅ | ✅ | 仅本人 |

## 运行测试

```bash
# 运行所有测试
pytest

# 运行单元测试
pytest tests/unit/

# 运行集成测试
pytest tests/integration/

# 查看测试覆盖率
pytest --cov=app tests/
```

## 数据验证规则

### 学号格式
- 格式: 7位数字(4位年份+3位序号)
- 示例: 2024001

### 成绩范围
- 范围: 0-100
- 类型: 浮点数

### 年龄范围
- 范围: 0-150

### 身份证号
- 格式: 18位(17位数字+1位校验码)

### 邮箱格式
- 标准邮箱格式验证

### 手机号格式
- 中国大陆手机号: 1开头,11位数字

## 成绩等级和GPA

### 等级划分

| 分数区间 | 等级 | 绩点 |
|---------|------|------|
| 90-100 | A | 4.0 |
| 85-89 | A- | 3.7 |
| 82-84 | B+ | 3.3 |
| 78-81 | B | 3.0 |
| 75-77 | B- | 2.7 |
| 72-74 | C+ | 2.3 |
| 68-71 | C | 2.0 |
| 64-67 | C- | 1.7 |
| 60-63 | D | 1.0 |
| <60 | F | 0.0 |

## 常见问题

### 1. 如何修改数据库配置?

编辑 `app/core/config.py` 文件,修改 `DATABASE_URL`:

```python
DATABASE_URL: str = "postgresql://user:password@localhost/dbname"
```

### 2. 如何修改JWT密钥?

编辑 `app/core/config.py` 文件,修改 `SECRET_KEY`:

```python
SECRET_KEY: str = "your-new-secret-key"
```

### 3. 如何添加新的API接口?

1. 在 `app/api/v1/` 创建新的路由文件
2. 在 `main.py` 中注册路由
3. 实现对应的Service和Repository

### 4. 如何部署到生产环境?

```bash
# 使用gunicorn部署
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker

# 使用Docker部署
# 创建Dockerfile并构建镜像
```

## 性能优化建议

1. **数据库索引**: 在高频查询字段添加索引
2. **缓存机制**: 使用Redis缓存热点数据
3. **分页查询**: 所有列表接口均支持分页
4. **连接池**: 配置合理的数据库连接池大小

## 安全建议

1. ✅ 使用HTTPS协议
2. ✅ 修改默认密钥和密码
3. ✅ 配置CORS白名单
4. ✅ 实施访问频率限制
5. ✅ 定期更新依赖包
6. ✅ 记录审计日志

## 后续开发计划

- [ ] 课程管理API
- [ ] 班级管理API
- [ ] 用户管理API
- [ ] 文件上传功能
- [ ] 数据导入导出
- [ ] 消息通知功能
- [ ] 前端界面开发

## 技术支持

如有问题,请查看:
- 📖 API文档: http://localhost:8000/docs
- 📝 设计文档: 项目根目录下的设计文档
- 🐛 问题反馈: 提交Issue

## 更新日志

### v1.0.0 (2025-10-23)
- ✅ 完成基础架构搭建
- ✅ 实现用户认证功能
- ✅ 实现学生管理功能
- ✅ 实现成绩管理功能
- ✅ 实现统计分析功能
- ✅ 添加单元测试和集成测试
